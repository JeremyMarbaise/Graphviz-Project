<!DOCTYPE html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>graphviz demo</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script language="javascript" src="jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="gridstyle.css">

</head>


<body>
    <div class="grid">
        <div class="SideBackground"></div>
        <label id="selectLabel" class="grid-item">Select a job</label>
        <select id="JobSelect" class="grid-item">
        </select>
        <div id="svg"></svg></div>



    </div>
    <footer class="footer">
       
    </footer>
</body>

<script>
    //***********************************************************************//
    //Display filenames in server/Excelfiles repository as options of select component
    //***********************************************************************//
    var oldOptions;
    var newOptions;
    $("#JobSelect").click(function(){
        $.ajax({url:"getFilenames",success: function(result){
        newOptions=result;
        $("#label").text(newOptions);
        if(JSON.stringify(newOptions)!=JSON.stringify(oldOptions))
        {
            $("#JobSelect").empty()
            $.each(newOptions,function(index,filename){
            
            $("#JobSelect").append($("<option></option>")
                .attr("value", filename).text(filename));
            });   
        }
        //Oldoptions are saved so the ui gets only uptdated when a filename gets changed/deleted/added 
        oldOptions=newOptions;    
        }});

        //*******************************************************************//
        // the dot source is converted into a readable format for vis Network
        //*******************************************************************//
        $("#JobSelect").on('change',function(){
            var selectedFilename=$('#JobSelect option:selected').text();
            $.ajax({url:"/GetDotSource?filename="+selectedFilename,success: function(result){
                
              
                $("#svg").empty();
                var parsedData=vis.parseDOTNetwork(result);

                var data=
                {
                    nodes: parsedData.nodes,
                    edges: parsedData.edges
                }
                var options=parsedData.options;
                var network=new vis.Network(document.getElementById("svg"),data,options);

            }});

});

});
</script>


