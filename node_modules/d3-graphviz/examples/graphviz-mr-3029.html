<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="../node_modules/d3/dist/d3.js"></script>
<script src="../node_modules/@hpcc-js/wasm/dist/graphviz.umd.js" type="javascript/worker"></script>
<script src="../build/d3-graphviz.js"></script>
<div id="graph" style="text-align: center;"></div>
<script>

let fontsize = 1;
let graphviz = d3.select("#graph").graphviz()
    .on("initEnd", render);

function render() {
    dot = generateDot();
    graphviz
        .renderDot(dot)
        .on("end", function () {
            const height = d3.select("#graph").select("#node1").select("text").node().getBBox().height;
//            const height = d3.select("#graph").select("#node1").select("text").node().getBoundingClientRect().height;
            const height_pt = height * 4 / 3;
//            console.log(fontsize, height_pt, height_pt / fontsize);
            console.log(fontsize, height, height / fontsize);
            ++fontsize;
            if (fontsize <= 100) {
                render();
            }
        });
}

function generateDot() {
    return `
digraph  {
    node [fontname="Courier" fontsize=${fontsize}]
    a [fillcolor="#d62728" label="H"]
    b [fillcolor="#1f77b4" label="j"]
    c [fillcolor="#2ca02c" label="y"]
    d [fillcolor="#ff7f0e"]
    a -> b
    a -> c
    a -> d
}
    `;
}

</script>
